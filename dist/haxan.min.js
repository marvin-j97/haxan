"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Haxan={})}(void 0,function(t){var n,e,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=(e=Error,o(i,e),i);function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.isHaxanError=!0,t}function s(t){return t&&!0===t.isHaxanError}var u,l=(o(a,u=r),a);function a(){var t=u.call(this)||this;return t.isTimeout=!0,t}var p,y=(o(c,p=r),c);function c(t){var e=p.call(this)||this;return e.isRejection=!0,e.response=t,e}var f,d,b,m=(o(h,f=r),h);function h(){var t=f.call(this)||this;return t.isAbort=!0,t}(o=d=d||{}).Auto="auto",o.Json="json",o.Text="text",o.Stream="stream",(o=b=b||{}).Get="GET",o.Post="POST",o.Put="PUT",o.Patch="PATCH",o.Delete="DELETE",o.Head="HEAD",o.Options="OPTIONS";var v=Object.freeze({__proto__:null,HaxanError:r,isHaxanError:s,HaxanTimeout:l,isHaxanTimeout:function(t){return s(t)&&!0===t.isTimeout},HaxanRejection:y,isHaxanRejection:function(t){return s(t)&&!0===t.isRejection},HaxanAbort:m,isHaxanAbort:function(t){return s(t)&&!0===t.isAbort},get ResponseType(){return d},get HTTPMethod(){return b}});var _=function(){return(_=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},w=function(t,s,u,a){return new(u=u||Promise)(function(o,e){function n(t){try{i(a.next(t))}catch(t){e(t)}}function r(t){try{i(a.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?o(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(n,r)}i((a=a.apply(t,s||[])).next())})},x=function(o,n){var r,i,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,i&&(s=2&e[0]?i.return:e[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,e[1])).done)return s;switch(i=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,i=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=n.call(o,u)}catch(t){e=[6,t],i=0}finally{r=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},P=(T.prototype.setProp=function(t,e){return this._opts[t]=e,this},T.prototype.rejectOn=function(t){return this.setProp("rejectOn",t)},T.prototype.url=function(t){return this.setProp("url",t)},T.prototype.type=function(t){return this.setProp("type",t)},T.prototype.method=function(t){return this.setProp("method",t)},T.prototype.get=function(){return this.method("GET")},T.prototype.head=function(){return this.method("HEAD")},T.prototype.options=function(){return this.method("OPTIONS")},T.prototype.post=function(t){return this.body(t).method("POST")},T.prototype.put=function(t){return this.body(t).method("PUT")},T.prototype.patch=function(t){return this.body(t).method("PATCH")},T.prototype.delete=function(){return this.method("DELETE")},T.prototype.body=function(t){return this.setProp("body",t)},T.prototype.header=function(t,e){return this._opts.headers[t]=e,this},T.prototype.param=function(t,e){return this._opts.query[t]=e,this},T.prototype.timeout=function(t){return this.setProp("timeout",t)},T.prototype.abort=function(t){return this.setProp("abortSignal",t)},T.prototype.normalizedBody=function(){var t=this._opts.body;return null===t?null:"string"==typeof t?t:JSON.stringify(t)},T.prototype.parseBody=function(o){return w(this,void 0,void 0,function(){var e;return x(this,function(t){switch(t.label){case 0:return(e=o.headers.get("content-type"))&&e.startsWith("application/json")?[4,o.json()]:[3,2];case 1:return[2,t.sent()];case 2:return[4,o.text()];case 3:return[2,t.sent()]}})})},T.prototype.getOptions=function(){return this._opts},T.prototype.send=function(){return this.execute()},T.prototype.execute=function(){return this.request()},T.prototype.request=function(){return w(this,void 0,void 0,function(){var r,i,s,u,a,p,c,f,h=this;return x(this,function(t){switch(t.label){case 0:return t.trys.push([0,9,,10]),r=void 0,i="undefined"!=typeof window&&"[object Window]"==={}.toString.call(window),r=i?fetch:require("node-fetch"),s=Object.keys(this._opts.query).length?this._opts.url+"?"+(n=this._opts.query,Object.keys(n).map(function(t){return t+"="+String(n[t])}).join("&")):this._opts.url,[4,Promise.race([r(s,{method:this._opts.method,headers:_(_({"Content-Type":"application/json"},this._opts.headers),{"User-Agent":"Haxan 0.2.1"}),body:(e=this._opts.method,[b.Put,b.Post,b.Patch].includes(e.toUpperCase())?this.normalizedBody():void 0),signal:this._opts.abortSignal}),new Promise(function(t,e){return setTimeout(function(){return e(new l)},h._opts.timeout)})])];case 1:if(u=t.sent(),this._opts.rejectOn(u.status))throw new y(u);return(e=u.headers,o={},e.forEach(function(t,e){o[e]=t}),a=o,this._opts.type!==d.Auto)?[3,3]:(p={},[4,this.parseBody(u)]);case 2:return[2,(p.data=t.sent(),p.ok=u.ok,p.status=u.status,p.headers=a,p)];case 3:return this._opts.type!==d.Json?[3,5]:(c={},[4,u.json()]);case 4:return[2,(c.data=t.sent(),c.ok=u.ok,c.status=u.status,c.headers=a,c)];case 5:return this._opts.type!==d.Text?[3,7]:(f={},[4,u.text()]);case 6:return[2,(f.data=t.sent(),f.ok=u.ok,f.status=u.status,f.headers=a,f)];case 7:if(this._opts.type===d.Stream&&!i)return[2,{data:u.body,ok:u.ok,status:u.status,headers:a}];t.label=8;case 8:throw new Error("No valid response body parsing method found");case 9:if("AbortError"===(a=t.sent()).name)throw new m;throw a;case 10:return[2]}var o,e,n})})},T);function T(t,e){this._opts={url:"",headers:{},query:{},method:b.Get,body:void 0,type:d.Auto,rejectOn:function(){return!1},abortSignal:void 0,timeout:3e4},e&&Object.assign(this._opts,e),this.url(t)}function j(t,e){return new P(t,e)}r=function(){var t,e=j;for(t in v)e[t]=v[t];return e.HaxanFactory=P,e}();t.HaxanFactory=P,t.default=r,Object.defineProperty(t,"__esModule",{value:!0})});
