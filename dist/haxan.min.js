"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Haxan={})}(void 0,function(c){function e(t){var e=String(t);if("[object Object]"===e)try{e=JSON.stringify(t)}catch(t){}return e}function t(){this.some=!1,this.none=!0}var i=new(t.prototype[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:void 0}}}},t.prototype.unwrapOr=function(t){return t},t.prototype.expect=function(t){throw new Error(""+t)},t.prototype.unwrap=function(){throw new Error("Tried to unwrap None")},t.prototype.map=function(t){return this},t.prototype.andThen=function(t){return this},t.prototype.toResult=function(t){return u(t)},t.prototype.toString=function(){return"None"},t);function r(t){if(!(this instanceof r))return new r(t);this.some=!0,this.none=!1,this.val=t}Object.freeze(i);var s=(r.prototype[Symbol.iterator]=function(){var t=Object(this.val);return Symbol.iterator in t?t[Symbol.iterator]():{next:function(){return{done:!0,value:void 0}}}},r.prototype.unwrapOr=function(t){return this.val},r.prototype.expect=function(t){return this.val},r.prototype.unwrap=function(){return this.val},r.prototype.map=function(t){return s(t(this.val))},r.prototype.andThen=function(t){return t(this.val)},r.prototype.toResult=function(t){return a(this.val)},r.prototype.safeUnwrap=function(){return this.val},r.prototype.toString=function(){return"Some("+e(this.val)+")"},r.EMPTY=new r(void 0),r);function n(t){if(!(this instanceof n))return new n(t);this.ok=!1,this.err=!0,this.val=t;t=(new Error).stack.split("\n").slice(2);t&&0<t.length&&t[0].includes("ErrImpl")&&t.shift(),this._stack=t.join("\n")}(T={}).all=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=[],n=0,o=t;n<o.length;n++){var i=o[n];if(!i.some)return i;r.push(i.val)}return s(r)},T.any=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=0,n=t;r<n.length;r++){var o=n[r];return o.some,o}return i},T.isOption=function(t){return t instanceof s||t===i};var u=(n.prototype[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:void 0}}}},n.prototype.else=function(t){return t},n.prototype.unwrapOr=function(t){return t},n.prototype.expect=function(t){throw new Error(t+" - Error: "+e(this.val)+"\n"+this._stack)},n.prototype.unwrap=function(){throw new Error("Tried to unwrap Error: "+e(this.val)+"\n"+this._stack)},n.prototype.map=function(t){return this},n.prototype.andThen=function(t){return this},n.prototype.mapErr=function(t){return new u(t(this.val))},n.prototype.toOption=function(){return i},n.prototype.toString=function(){return"Err("+e(this.val)+")"},Object.defineProperty(n.prototype,"stack",{get:function(){return this+"\n"+this._stack},enumerable:!1,configurable:!0}),n.EMPTY=new n(void 0),n);function o(t){if(!(this instanceof o))return new o(t);this.ok=!0,this.err=!1,this.val=t}var a=(o.prototype[Symbol.iterator]=function(){var t=Object(this.val);return Symbol.iterator in t?t[Symbol.iterator]():{next:function(){return{done:!0,value:void 0}}}},o.prototype.else=function(t){return this.val},o.prototype.unwrapOr=function(t){return this.val},o.prototype.expect=function(t){return this.val},o.prototype.unwrap=function(){return this.val},o.prototype.map=function(t){return new a(t(this.val))},o.prototype.andThen=function(t){return t(this.val)},o.prototype.mapErr=function(t){return this},o.prototype.toOption=function(){return s(this.val)},o.prototype.safeUnwrap=function(){return this.val},o.prototype.toString=function(){return"Ok("+e(this.val)+")"},o.EMPTY=new o(void 0),o);(T={}).all=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=[],n=0,o=t;n<o.length;n++){var i=o[n];if(!i.ok)return i;r.push(i.val)}return new a(r)},T.any=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=[],n=0,o=t;n<o.length;n++){var i=o[n];if(i.ok)return i;r.push(i.val)}return new u(r)},T.wrap=function(t){try{return new a(t())}catch(t){return new u(t)}},T.wrapAsync=function(t){try{return t().then(function(t){return new a(t)}).catch(function(t){return new u(t)})}catch(t){return Promise.resolve(new u(t))}},T.isResult=function(t){return t instanceof u||t instanceof a},c.HaxanErrorType=void 0,(T=c.HaxanErrorType||(c.HaxanErrorType={})).NetworkError="NetworkError",T.ParseError="ParseError",T.Timeout="Timeout",T.Abort="Abort";var h=(p.prototype.getMessage=function(){return this.message},p.prototype.getType=function(){return this.type},p.prototype.getOriginalError=function(){return this.rawError},p.prototype.getResponse=function(){return this.response},p);function p(t,e,r,n){this.rawError=null,this.response=null,this.message=e,this.type=t,r&&(this.rawError=r),n&&(this.response=n)}c.ResponseType=void 0,(T=c.ResponseType||(c.ResponseType={})).Auto="auto",T.Json="json",T.Text="text",T.Stream="stream",T.Blob="blob",T.ArrayBuffer="arraybuffer",c.HTTPMethod=void 0,(T=c.HTTPMethod||(c.HTTPMethod={})).Get="GET",T.Post="POST",T.Put="PUT",T.Patch="PATCH",T.Delete="DELETE",T.Head="HEAD",T.Options="OPTIONS";var f=Object.freeze({__proto__:null,get ResponseType(){return c.ResponseType},get HTTPMethod(){return c.HTTPMethod},get HaxanErrorType(){return c.HaxanErrorType},HaxanError:h});var y=function(){return(y=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},d=function(t,s,u,a){return new(u=u||Promise)(function(r,e){function n(t){try{i(a.next(t))}catch(t){e(t)}}function o(t){try{i(a.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?r(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(n,o)}i((a=a.apply(t,s||[])).next())})},l=function(r,n){var o,i,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;u;)try{if(o=1,i&&(s=2&e[0]?i.return:e[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,e[1])).done)return s;switch(i=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,i=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=n.call(r,u)}catch(t){e=[6,t],i=0}finally{o=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};var v=(b.prototype.setProp=function(t,e){return this._opts[t]=e,this},b.prototype.redirect=function(t){return this.setProp("redirect",t)},b.prototype.addOptions=function(t){return this._addOptions=t,this},b.prototype.url=function(t){return this.setProp("url",t)},b.prototype.type=function(t){return this.setProp("type",t)},b.prototype.method=function(t){return this.setProp("method",t)},b.prototype.get=function(){return this.method(c.HTTPMethod.Get)},b.prototype.head=function(){return this.method(c.HTTPMethod.Head)},b.prototype.options=function(){return this.method(c.HTTPMethod.Options)},b.prototype.post=function(t){return this.body(t).method(c.HTTPMethod.Post)},b.prototype.put=function(t){return this.body(t).method(c.HTTPMethod.Put)},b.prototype.patch=function(t){return this.body(t).method(c.HTTPMethod.Patch)},b.prototype.delete=function(){return this.method(c.HTTPMethod.Delete)},b.prototype.body=function(t){return this.setProp("body",t)},b.prototype.header=function(t,e){return this._opts.headers[t]=e,this},b.prototype.param=function(t,e){return this._opts.query[t]=e,this},b.prototype.timeout=function(t){return this.setProp("timeout",t)},b.prototype.abort=function(t){return this.setProp("abortSignal",t)},b.prototype.normalizedBody=function(){var t=this._opts.body;return null===t?null:"string"==typeof t?t:JSON.stringify(t)},b.prototype.parseBody=function(r){return d(this,void 0,void 0,function(){var e;return l(this,function(t){switch(t.label){case 0:return(e=r.headers.get("content-type"))&&e.startsWith("application/json")?[4,r.json()]:[3,2];case 1:return[2,t.sent()];case 2:return[4,r.text()];case 3:return[2,t.sent()]}})})},b.prototype.getOptions=function(){return this._opts},b.prototype.parseResponse=function(p){return d(this,void 0,void 0,function(){var n,o,i,s,u,a;return l(this,function(t){switch(t.label){case 0:return(t.trys.push([0,12,,13]),e=p.headers,r={},e.forEach(function(t,e){r[e]=t}),n=r,this._opts.type!==c.ResponseType.Auto)?[3,2]:(o={},[4,this.parseBody(p)]);case 1:return[2,(o.data=t.sent(),o.ok=p.ok,o.redirected=p.redirected,o.status=p.status,o.headers=n,o)];case 2:return this._opts.type!==c.ResponseType.Json?[3,4]:(i={},[4,p.json()]);case 3:return[2,(i.data=t.sent(),i.ok=p.ok,i.redirected=p.redirected,i.status=p.status,i.headers=n,i)];case 4:return this._opts.type!==c.ResponseType.Text?[3,6]:(s={},[4,p.text()]);case 5:return[2,(s.data=t.sent(),s.ok=p.ok,s.redirected=p.redirected,s.status=p.status,s.headers=n,s)];case 6:return this._opts.type!==c.ResponseType.Blob?[3,8]:(u={},[4,p.blob()]);case 7:return[2,(u.data=t.sent(),u.ok=p.ok,u.redirected=p.redirected,u.status=p.status,u.headers=n,u)];case 8:return this._opts.type!==c.ResponseType.ArrayBuffer?[3,10]:(a={},[4,p.arrayBuffer()]);case 9:return[2,(a.data=t.sent(),a.ok=p.ok,a.redirected=p.redirected,a.status=p.status,a.headers=n,a)];case 10:if(this._opts.type===c.ResponseType.Stream&&("undefined"==typeof window||"[object Window]"!=={}.toString.call(window)))return[2,{data:p.body,ok:p.ok,redirected:p.redirected,status:p.status,headers:n}];t.label=11;case 11:throw new h(c.HaxanErrorType.ParseError,"No valid response body parsing method found",null,{data:p.body,ok:p.ok,redirected:p.redirected,status:p.status,headers:n});case 12:if((n=t.sent()).type===c.HaxanErrorType.ParseError)throw n;throw new Error("Error during parsing response body: "+n.message);case 13:return[2]}var e,r})})},b.prototype.buildUrl=function(){return Object.keys(this._opts.query).length?this._opts.url+"?"+(e=this._opts.query,Object.keys(e).map(function(t){return t+"="+String(e[t])}).join("&")):this._opts.url;var e},b.prototype.doRequest=function(){return d(this,void 0,void 0,function(){var e,r;return l(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),e=y({"Content-Type":"application/json"},this._opts.headers),"undefined"==typeof window&&(e["User-Agent"]="Haxan 0.7.0-next.2"),[4,this._fetch()(this.buildUrl(),y({method:this._opts.method,headers:e,body:this.normalizedBody(),signal:this._opts.abortSignal,redirect:this._opts.redirect},this._addOptions))];case 1:return r=t.sent(),[4,this.parseResponse(r)];case 2:return[2,t.sent()];case 3:if((r=t.sent()).getType)throw r;if("AbortError"===r.name)throw new h(c.HaxanErrorType.Abort,"Request aborted",r);throw new h(c.HaxanErrorType.NetworkError,"Network error",r);case 4:return[2]}})})},b.prototype.send=function(){return this.execute()},b.prototype.execute=function(){return this.request()},b.prototype.request=function(){return d(this,void 0,void 0,function(){var e;return l(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Promise.race([this.doRequest(),(r=this._opts.timeout,new Promise(function(t,e){return setTimeout(function(){return e(new h(c.HaxanErrorType.Timeout,"Request timed out (Reached "+r+"ms)",null))},r)}))])];case 1:return e=t.sent(),[2,a(e)];case 2:return e=t.sent(),[2,u(e)];case 3:return[2]}var r})})},b);function b(t,e){this._opts={url:"",headers:{},query:{},method:c.HTTPMethod.Get,body:void 0,type:c.ResponseType.Auto,abortSignal:void 0,timeout:3e4,redirect:"follow"},this._addOptions={},this._fetch=e||function(){return fetch},this.url(t)}function w(t,e){return new v(t,e)}var T=function(){var t,e=w;for(t in f)e[t]=f[t];return e.HaxanFactory=v,e}();c.HaxanError=h,c.HaxanFactory=v,c.default=T,Object.defineProperty(c,"__esModule",{value:!0})});
