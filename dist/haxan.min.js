"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Haxan={})}(void 0,function(t){var a;(d=a=a||{}).NetworkError="NetworkError",d.ParseError="ParseError",d.Timeout="Timeout",d.Abort="Abort";var p,o,c=(e.prototype.getMessage=function(){return this.message},e.prototype.getType=function(){return this.type},e.prototype.getOriginalError=function(){return this.rawError},e.prototype.getResponse=function(){return this.response},e);function e(t,e,r,o){this.rawError=null,this.response=null,this.message=e,this.type=t,r&&(this.rawError=r),o&&(this.response=o)}(d=p=p||{}).Auto="auto",d.Json="json",d.Text="text",d.Stream="stream",(d=o=o||{}).Get="GET",d.Post="POST",d.Put="PUT",d.Patch="PATCH",d.Delete="DELETE",d.Head="HEAD",d.Options="OPTIONS";var r=Object.freeze({__proto__:null,get ResponseType(){return p},get HTTPMethod(){return o},get HaxanErrorType(){return a},HaxanError:c});function h(){return"undefined"!=typeof window&&"[object Window]"==={}.toString.call(window)}var n=function(){return(n=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},s=function(t,i,u,a){return new(u=u||Promise)(function(r,e){function o(t){try{s(a.next(t))}catch(t){e(t)}}function n(t){try{s(a.throw(t))}catch(t){e(t)}}function s(t){var e;t.done?r(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(o,n)}s((a=a.apply(t,i||[])).next())})},f=function(r,o){var n,s,i,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,s&&(i=2&e[0]?s.return:e[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,e[1])).done)return i;switch(s=0,(e=i?[2&e[0],i.value]:e)[0]){case 0:case 1:i=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,s=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(i=0<(i=u.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){u.label=e[1];break}if(6===e[0]&&u.label<i[1]){u.label=i[1],i=e;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(e);break}i[2]&&u.ops.pop(),u.trys.pop();continue}e=o.call(r,u)}catch(t){e=[6,t],s=0}finally{n=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};var i=(u.prototype.setProp=function(t,e){return this._opts[t]=e,this},u.prototype.url=function(t){return this.setProp("url",t)},u.prototype.type=function(t){return this.setProp("type",t)},u.prototype.method=function(t){return this.setProp("method",t)},u.prototype.get=function(){return this.method("GET")},u.prototype.head=function(){return this.method("HEAD")},u.prototype.options=function(){return this.method("OPTIONS")},u.prototype.post=function(t){return this.body(t).method("POST")},u.prototype.put=function(t){return this.body(t).method("PUT")},u.prototype.patch=function(t){return this.body(t).method("PATCH")},u.prototype.delete=function(){return this.method("DELETE")},u.prototype.body=function(t){return this.setProp("body",t)},u.prototype.header=function(t,e){return this._opts.headers[t]=e,this},u.prototype.param=function(t,e){return this._opts.query[t]=e,this},u.prototype.timeout=function(t){return this.setProp("timeout",t)},u.prototype.abort=function(t){return this.setProp("abortSignal",t)},u.prototype.normalizedBody=function(){var t=this._opts.body;return null===t?null:"string"==typeof t?t:JSON.stringify(t)},u.prototype.parseBody=function(r){return s(this,void 0,void 0,function(){var e;return f(this,function(t){switch(t.label){case 0:return(e=r.headers.get("content-type"))&&e.startsWith("application/json")?[4,r.json()]:[3,2];case 1:return[2,t.sent()];case 2:return[4,r.text()];case 3:return[2,t.sent()]}})})},u.prototype.getOptions=function(){return this._opts},u.prototype.send=function(){return this.execute()},u.prototype.execute=function(){return this.request()},u.prototype.parseResponse=function(u){return s(this,void 0,void 0,function(){var o,n,s,i;return f(this,function(t){switch(t.label){case 0:return(t.trys.push([0,8,,9]),e=u.headers,r={},e.forEach(function(t,e){r[e]=t}),o=r,this._opts.type!==p.Auto)?[3,2]:(n={},[4,this.parseBody(u)]);case 1:return[2,(n.data=t.sent(),n.ok=u.ok,n.status=u.status,n.headers=o,n)];case 2:return this._opts.type!==p.Json?[3,4]:(s={},[4,u.json()]);case 3:return[2,(s.data=t.sent(),s.ok=u.ok,s.status=u.status,s.headers=o,s)];case 4:return this._opts.type!==p.Text?[3,6]:(i={},[4,u.text()]);case 5:return[2,(i.data=t.sent(),i.ok=u.ok,i.status=u.status,i.headers=o,i)];case 6:if(this._opts.type===p.Stream&&!h())return[2,{data:u.body,ok:u.ok,status:u.status,headers:o}];t.label=7;case 7:throw new c(a.ParseError,"No valid response body parsing method found",null,{data:u.body,ok:u.ok,status:u.status,headers:o});case 8:throw t.sent(),new Error("Error during parsing response body");case 9:return[2]}var e,r})})},u.prototype.buildUrl=function(){return Object.keys(this._opts.query).length?this._opts.url+"?"+(e=this._opts.query,Object.keys(e).map(function(t){return t+"="+String(e[t])}).join("&")):this._opts.url;var e},u.prototype.doRequest=function(){return s(this,void 0,void 0,function(){var r;return f(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,(h()?fetch:require("node-fetch"))(this.buildUrl(),{method:this._opts.method,headers:n(n({"Content-Type":"application/json"},this._opts.headers),{"User-Agent":"Haxan 0.3.0"}),body:(e=this._opts.method,[o.Put,o.Post,o.Patch].includes(e.toUpperCase())?this.normalizedBody():void 0),signal:this._opts.abortSignal})];case 1:return r=t.sent(),[4,this.parseResponse(r)];case 2:return[2,t.sent()];case 3:if(r=t.sent(),"AbortError"===(r=r).name)throw new c(a.Abort,"Request aborted",r);throw new c(a.NetworkError,"Network error",r);case 4:return[2]}var e})})},u.prototype.request=function(){return s(this,void 0,void 0,function(){return f(this,function(t){switch(t.label){case 0:return[4,Promise.race([this.doRequest(),(r=this._opts.timeout,new Promise(function(t,e){return setTimeout(function(){return e(new c(a.Timeout,"Request timed out (Reached "+r+"ms)",null))},r)}))])];case 1:return[2,t.sent()]}var r})})},u);function u(t,e){this._opts={url:"",headers:{},query:{},method:o.Get,body:void 0,type:p.Auto,abortSignal:void 0,timeout:3e4},e&&Object.assign(this._opts,e),this.url(t)}function y(t,e){return new i(t,e)}var d=function(){var t,e=y;for(t in r)e[t]=r[t];return e.HaxanFactory=i,e}();t.HaxanFactory=i,t.default=d,Object.defineProperty(t,"__esModule",{value:!0})});
