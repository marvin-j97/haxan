"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Haxan={})}(void 0,function(a){a.HaxanErrorType=void 0,(u=a.HaxanErrorType||(a.HaxanErrorType={})).NetworkError="NetworkError",u.ParseError="ParseError",u.Timeout="Timeout",u.Abort="Abort";var p=(t.prototype.getMessage=function(){return this.message},t.prototype.getType=function(){return this.type},t.prototype.getOriginalError=function(){return this.rawError},t.prototype.getResponse=function(){return this.response},t);function t(t,e,r,o){this.rawError=null,this.response=null,this.message=e,this.type=t,r&&(this.rawError=r),o&&(this.response=o)}a.ResponseType=void 0,(u=a.ResponseType||(a.ResponseType={})).Auto="auto",u.Json="json",u.Text="text",u.Stream="stream",a.HTTPMethod=void 0,(u=a.HTTPMethod||(a.HTTPMethod={})).Get="GET",u.Post="POST",u.Put="PUT",u.Patch="PATCH",u.Delete="DELETE",u.Head="HEAD",u.Options="OPTIONS";var r=Object.freeze({__proto__:null,get ResponseType(){return a.ResponseType},get HTTPMethod(){return a.HTTPMethod},get HaxanErrorType(){return a.HaxanErrorType},HaxanError:p});var o=function(){return(o=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},e=function(t,i,u,a){return new(u=u||Promise)(function(r,e){function o(t){try{s(a.next(t))}catch(t){e(t)}}function n(t){try{s(a.throw(t))}catch(t){e(t)}}function s(t){var e;t.done?r(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(o,n)}s((a=a.apply(t,i||[])).next())})},h=function(r,o){var n,s,i,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,s&&(i=2&e[0]?s.return:e[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,e[1])).done)return i;switch(s=0,(e=i?[2&e[0],i.value]:e)[0]){case 0:case 1:i=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,s=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(i=0<(i=u.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){u.label=e[1];break}if(6===e[0]&&u.label<i[1]){u.label=i[1],i=e;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(e);break}i[2]&&u.ops.pop(),u.trys.pop();continue}e=o.call(r,u)}catch(t){e=[6,t],s=0}finally{n=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};var n=(s.prototype.setProp=function(t,e){return this._opts[t]=e,this},s.prototype.redirect=function(t){return this.setProp("redirect",t)},s.prototype.addOptions=function(t){return this._addOptions=t,this},s.prototype.url=function(t){return this.setProp("url",t)},s.prototype.type=function(t){return this.setProp("type",t)},s.prototype.method=function(t){return this.setProp("method",t)},s.prototype.get=function(){return this.method(a.HTTPMethod.Get)},s.prototype.head=function(){return this.method(a.HTTPMethod.Head)},s.prototype.options=function(){return this.method(a.HTTPMethod.Options)},s.prototype.post=function(t){return this.body(t).method(a.HTTPMethod.Post)},s.prototype.put=function(t){return this.body(t).method(a.HTTPMethod.Put)},s.prototype.patch=function(t){return this.body(t).method(a.HTTPMethod.Patch)},s.prototype.delete=function(){return this.method(a.HTTPMethod.Delete)},s.prototype.body=function(t){return this.setProp("body",t)},s.prototype.header=function(t,e){return this._opts.headers[t]=e,this},s.prototype.param=function(t,e){return this._opts.query[t]=e,this},s.prototype.timeout=function(t){return this.setProp("timeout",t)},s.prototype.abort=function(t){return this.setProp("abortSignal",t)},s.prototype.normalizedBody=function(){var t=this._opts.body;return null===t?null:"string"==typeof t?t:JSON.stringify(t)},s.prototype.parseBody=function(r){return e(this,void 0,void 0,function(){var e;return h(this,function(t){switch(t.label){case 0:return(e=r.headers.get("content-type"))&&e.startsWith("application/json")?[4,r.json()]:[3,2];case 1:return[2,t.sent()];case 2:return[4,r.text()];case 3:return[2,t.sent()]}})})},s.prototype.getOptions=function(){return this._opts},s.prototype.send=function(){return this.execute()},s.prototype.execute=function(){return this.request()},s.prototype.parseResponse=function(u){return e(this,void 0,void 0,function(){var o,n,s,i;return h(this,function(t){switch(t.label){case 0:return(t.trys.push([0,8,,9]),e=u.headers,r={},e.forEach(function(t,e){r[e]=t}),o=r,this._opts.type!==a.ResponseType.Auto)?[3,2]:(n={},[4,this.parseBody(u)]);case 1:return[2,(n.data=t.sent(),n.ok=u.ok,n.status=u.status,n.headers=o,n)];case 2:return this._opts.type!==a.ResponseType.Json?[3,4]:(s={},[4,u.json()]);case 3:return[2,(s.data=t.sent(),s.ok=u.ok,s.status=u.status,s.headers=o,s)];case 4:return this._opts.type!==a.ResponseType.Text?[3,6]:(i={},[4,u.text()]);case 5:return[2,(i.data=t.sent(),i.ok=u.ok,i.status=u.status,i.headers=o,i)];case 6:if(this._opts.type===a.ResponseType.Stream&&("undefined"==typeof window||"[object Window]"!=={}.toString.call(window)))return[2,{data:u.body,ok:u.ok,status:u.status,headers:o}];t.label=7;case 7:throw new p(a.HaxanErrorType.ParseError,"No valid response body parsing method found",null,{data:u.body,ok:u.ok,status:u.status,headers:o});case 8:if((o=t.sent()).type===a.HaxanErrorType.ParseError)throw o;throw new Error("Error during parsing response body: "+o.message);case 9:return[2]}var e,r})})},s.prototype.buildUrl=function(){return Object.keys(this._opts.query).length?this._opts.url+"?"+(e=this._opts.query,Object.keys(e).map(function(t){return t+"="+String(e[t])}).join("&")):this._opts.url;var e},s.prototype.doRequest=function(){return e(this,void 0,void 0,function(){var r;return h(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,this._fetch(this.buildUrl(),o({method:this._opts.method,headers:o(o({"Content-Type":"application/json"},this._opts.headers),{"User-Agent":"Haxan 0.6.0"}),body:(e=this._opts.method,[a.HTTPMethod.Put,a.HTTPMethod.Post,a.HTTPMethod.Patch].includes(e.toUpperCase())?this.normalizedBody():void 0),signal:this._opts.abortSignal,redirect:this._opts.redirect},this._addOptions))];case 1:return r=t.sent(),[4,this.parseResponse(r)];case 2:return[2,t.sent()];case 3:if((r=t.sent()).getType)throw r;if("AbortError"===r.name)throw new p(a.HaxanErrorType.Abort,"Request aborted",r);throw new p(a.HaxanErrorType.NetworkError,"Network error",r);case 4:return[2]}var e})})},s.prototype.request=function(){return e(this,void 0,void 0,function(){return h(this,function(t){switch(t.label){case 0:return[4,Promise.race([this.doRequest(),(r=this._opts.timeout,new Promise(function(t,e){return setTimeout(function(){return e(new p(a.HaxanErrorType.Timeout,"Request timed out (Reached "+r+"ms)",null))},r)}))])];case 1:return[2,t.sent()]}var r})})},s);function s(t,e,r){this._opts={url:"",headers:{},query:{},method:a.HTTPMethod.Get,body:void 0,type:a.ResponseType.Auto,abortSignal:void 0,timeout:3e4,redirect:"follow"},this._addOptions={},r&&Object.assign(this._opts,r),this._fetch=e||fetch,this.url(t)}function i(t,e,r){return new n(t,e,r)}var u=function(){var t,e=i;for(t in r)e[t]=r[t];return e.HaxanFactory=n,e}();a.HaxanError=p,a.HaxanFactory=n,a.default=u,Object.defineProperty(a,"__esModule",{value:!0})});
