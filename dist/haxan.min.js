"use strict";function _createForOfIteratorHelper(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,t=function(){};return{s:t,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,i=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){a=!0,n=e},f:function(){try{i||null==r.return||r.return()}finally{if(a)throw n}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t(exports,require("stream"),require("http"),require("url"),require("https"),require("zlib")):"function"==typeof define&&define.amd?define(["exports","stream","http","url","https","zlib"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Haxan={},e.Stream,e.http,e.Url,e.https,e.zlib)}(void 0,function(u,e,t,r,o,n){function i(e){return e&&"object"===_typeof(e)&&"default"in e?e:{default:e}}var b=i(e),a=i(t),r=i(r),s=i(o),m=i(n);var c,l=b.default.Readable,f=Symbol("buffer"),p=Symbol("type"),h=function(){function u(){_classCallCheck(this,u),this[p]="";var e=arguments[0],t=arguments[1],r=[];if(e)for(var o=e,n=Number(o.length),i=0;i<n;i++){var a=o[i],s=void 0;(s=a instanceof Buffer?a:ArrayBuffer.isView(a)?Buffer.from(a.buffer,a.byteOffset,a.byteLength):a instanceof ArrayBuffer?Buffer.from(a):a instanceof u?a[f]:Buffer.from("string"==typeof a?a:String(a))).length,r.push(s)}this[f]=Buffer.concat(r);t=t&&void 0!==t.type&&String(t.type).toLowerCase();t&&!/[^\u0020-\u007E]/.test(t)&&(this[p]=t)}return _createClass(u,[{key:"size",get:function(){return this[f].length}},{key:"type",get:function(){return this[p]}},{key:"text",value:function(){return Promise.resolve(this[f].toString())}},{key:"arrayBuffer",value:function(){var e=this[f],e=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return Promise.resolve(e)}},{key:"stream",value:function(){var e=new l;return e._read=function(){},e.push(this[f]),e.push(null),e}},{key:"toString",value:function(){return"[object Blob]"}},{key:"slice",value:function(){var e=this.size,t=arguments[0],r=arguments[1],t=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),e=void 0===r?e:r<0?Math.max(e+r,0):Math.min(r,e),e=Math.max(e-t,0),t=this[f].slice(t,t+e),e=new u([],{type:arguments[2]});return e[f]=t,e}}]),u}();function v(e,t,r){Error.call(this,e),this.message=e,this.type=t,r&&(this.code=this.errno=r.code),Error.captureStackTrace(this,this.constructor)}Object.defineProperties(h.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(h.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),((v.prototype=Object.create(Error.prototype)).constructor=v).prototype.name="FetchError";try{c=require("encoding").convert}catch(e){}var d=Symbol("Body internals"),y=b.default.PassThrough;function g(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=r.size,o=void 0===o?0:o,r=r.timeout,r=void 0===r?0:r;null==e?e=null:T(e)?e=Buffer.from(e.toString()):P(e)||Buffer.isBuffer(e)||("[object ArrayBuffer]"===Object.prototype.toString.call(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof b.default||(e=Buffer.from(String(e)))),this[d]={body:e,disturbed:!1,error:null},this.size=o,this.timeout=r,e instanceof b.default&&e.on("error",function(e){e="AbortError"===e.name?e:new v("Invalid response body while trying to fetch ".concat(t.url,": ").concat(e.message),"system",e);t[d].error=e})}function w(){var o=this;if(this[d].disturbed)return g.Promise.reject(new TypeError("body used already for: ".concat(this.url)));if(this[d].disturbed=!0,this[d].error)return g.Promise.reject(this[d].error);var n=this.body;if(null===n)return g.Promise.resolve(Buffer.alloc(0));if(P(n)&&(n=n.stream()),Buffer.isBuffer(n))return g.Promise.resolve(n);if(!(n instanceof b.default))return g.Promise.resolve(Buffer.alloc(0));var i=[],a=0,s=!1;return new g.Promise(function(e,t){var r;o.timeout&&(r=setTimeout(function(){s=!0,t(new v("Response timeout while trying to fetch ".concat(o.url," (over ").concat(o.timeout,"ms)"),"body-timeout"))},o.timeout)),n.on("error",function(e){"AbortError"===e.name?(s=!0,t(e)):t(new v("Invalid response body while trying to fetch ".concat(o.url,": ").concat(e.message),"system",e))}),n.on("data",function(e){if(!s&&null!==e){if(o.size&&a+e.length>o.size)return s=!0,void t(new v("content size at ".concat(o.url," over limit: ").concat(o.size),"max-size"));a+=e.length,i.push(e)}}),n.on("end",function(){if(!s){clearTimeout(r);try{e(Buffer.concat(i,a))}catch(e){t(new v("Could not create Buffer from response body for ".concat(o.url,": ").concat(e.message),"system",e))}}})})}function T(e){return"object"===_typeof(e)&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function P(e){return"object"===_typeof(e)&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function E(e){var t,r,o=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof b.default&&"function"!=typeof o.getBoundary&&(t=new y,r=new y,o.pipe(t),o.pipe(r),e[d].body=t,o=r),o}function k(e){return null===e?null:"string"==typeof e?"text/plain;charset=UTF-8":T(e)?"application/x-www-form-urlencoded;charset=UTF-8":P(e)?e.type||null:Buffer.isBuffer(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e)||ArrayBuffer.isView(e)?null:"function"==typeof e.getBoundary?"multipart/form-data;boundary=".concat(e.getBoundary()):e instanceof b.default?null:"text/plain;charset=UTF-8"}function S(e){e=e.body;return null===e?0:P(e)?e.size:Buffer.isBuffer(e)?e.length:e&&"function"==typeof e.getLengthSync&&(e._lengthRetrievers&&0==e._lengthRetrievers.length||e.hasKnownLength&&e.hasKnownLength())?e.getLengthSync():null}g.prototype={get body(){return this[d].body},get bodyUsed(){return this[d].disturbed},arrayBuffer:function(){return w.call(this).then(function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)})},blob:function(){var t=this.headers&&this.headers.get("content-type")||"";return w.call(this).then(function(e){return Object.assign(new h([],{type:t.toLowerCase()}),_defineProperty({},f,e))})},json:function(){var t=this;return w.call(this).then(function(e){try{return JSON.parse(e.toString())}catch(e){return g.Promise.reject(new v("invalid json response body at ".concat(t.url," reason: ").concat(e.message),"invalid-json"))}})},text:function(){return w.call(this).then(function(e){return e.toString()})},buffer:function(){return w.call(this)},textConverted:function(){var t=this;return w.call(this).then(function(e){return function(e,t){if("function"!=typeof c)throw new Error("The package `encoding` must be installed to use the textConverted() function");var r,o=t.get("content-type"),t="utf-8";o&&(r=/charset=([^;]*)/i.exec(o));o=e.slice(0,1024).toString(),!r&&o&&(r=/<meta.+?charset=(['"])(.+?)\1/i.exec(o));!r&&o&&((r=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(o))||(r=/<meta[\s]+?content=(['"])(.+?)\1[\s]+?http-equiv=(['"])content-type\3/i.exec(o))&&r.pop(),r=r&&/charset=(.*)/i.exec(r.pop()));!r&&o&&(r=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(o));r&&("gb2312"!==(t=r.pop())&&"gbk"!==t||(t="gb18030"));return c(e,"UTF-8",t).toString()}(e,t.headers)})}},Object.defineProperties(g.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),g.mixIn=function(e){var t,r=_createForOfIteratorHelper(Object.getOwnPropertyNames(g.prototype));try{for(r.s();!(t=r.n()).done;){var o,n=t.value;n in e||(o=Object.getOwnPropertyDescriptor(g.prototype,n),Object.defineProperty(e,n,o))}}catch(e){r.e(e)}finally{r.f()}},g.Promise=global.Promise;var x=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,O=/[^\t\x20-\x7e\x80-\xff]/;function _(e){if(e="".concat(e),x.test(e)||""===e)throw new TypeError("".concat(e," is not a legal HTTP header name"))}function j(e){if(e="".concat(e),O.test(e))throw new TypeError("".concat(e," is not a legal HTTP header value"))}function C(e,t){for(var r in t=t.toLowerCase(),e)if(r.toLowerCase()===t)return r}var H=Symbol("map"),A=function(){function w(){_classCallCheck(this,w);var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:void 0;if(this[H]=Object.create(null),e instanceof w)for(var t=e.raw(),r=0,o=Object.keys(t);r<o.length;r++){var n,i=o[r],a=_createForOfIteratorHelper(t[i]);try{for(a.s();!(n=a.n()).done;){var s=n.value;this.append(i,s)}}catch(e){a.e(e)}finally{a.f()}}else if(null!=e){if("object"!==_typeof(e))throw new TypeError("Provided initializer must be an object");var u=e[Symbol.iterator];if(null!=u){if("function"!=typeof u)throw new TypeError("Header pairs must be iterable");var c,l=[],f=_createForOfIteratorHelper(e);try{for(f.s();!(c=f.n()).done;){var p=c.value;if("object"!==_typeof(p)||"function"!=typeof p[Symbol.iterator])throw new TypeError("Each header pair must be iterable");l.push(Array.from(p))}}catch(e){f.e(e)}finally{f.f()}for(var h=0,d=l;h<d.length;h++){var y=d[h];if(2!==y.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(y[0],y[1])}}else for(var b=0,m=Object.keys(e);b<m.length;b++){var v=m[b],g=e[v];this.append(v,g)}}}return _createClass(w,[{key:"get",value:function(e){_(e="".concat(e));e=C(this[H],e);return void 0===e?null:this[H][e].join(", ")}},{key:"forEach",value:function(e){for(var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:void 0,r=B(this),o=0;o<r.length;){var n=r[o],i=n[0],n=n[1];e.call(t,n,i,this),r=B(this),o++}}},{key:"set",value:function(e,t){e="".concat(e),t="".concat(t),_(e),j(t);var r=C(this[H],e);this[H][void 0!==r?r:e]=[t]}},{key:"append",value:function(e,t){e="".concat(e),t="".concat(t),_(e),j(t);var r=C(this[H],e);void 0!==r?this[H][r].push(t):this[H][e]=[t]}},{key:"has",value:function(e){return _(e="".concat(e)),void 0!==C(this[H],e)}},{key:"delete",value:function(e){_(e="".concat(e));e=C(this[H],e);void 0!==e&&delete this[H][e]}},{key:"raw",value:function(){return this[H]}},{key:"keys",value:function(){return L(this,"key")}},{key:"values",value:function(){return L(this,"value")}},{key:Symbol.iterator,value:function(){return L(this,"key+value")}}]),w}();function B(t,e){e=1<arguments.length&&void 0!==e?e:"key+value";return Object.keys(t[H]).sort().map("key"===e?function(e){return e.toLowerCase()}:"value"===e?function(e){return t[H][e].join(", ")}:function(e){return[e.toLowerCase(),t[H][e].join(", ")]})}A.prototype.entries=A.prototype[Symbol.iterator],Object.defineProperty(A.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(A.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});var R=Symbol("internal");function L(e,t){var r=Object.create(q);return r[R]={target:e,kind:t,index:0},r}var q=Object.setPrototypeOf({next:function(){if(!this||Object.getPrototypeOf(this)!==q)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[R],t=e.target,r=e.kind,e=e.index,r=B(t,r);return r.length<=e?{value:void 0,done:!0}:(this[R].index=e+1,{value:r[e],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));Object.defineProperty(q,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});var z=Symbol("Response internals"),U=a.default.STATUS_CODES,I=function(){function n(){_classCallCheck(this,n);var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};g.call(this,e,t);var r=t.status||200,o=new A(t.headers);null==e||o.has("Content-Type")||(e=k(e))&&o.append("Content-Type",e),this[z]={url:t.url,status:r,statusText:t.statusText||U[r],headers:o,counter:t.counter}}return _createClass(n,[{key:"url",get:function(){return this[z].url||""}},{key:"status",get:function(){return this[z].status}},{key:"ok",get:function(){return 200<=this[z].status&&this[z].status<300}},{key:"redirected",get:function(){return 0<this[z].counter}},{key:"statusText",get:function(){return this[z].statusText}},{key:"headers",get:function(){return this[z].headers}},{key:"clone",value:function(){return new n(E(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}]),n}();g.mixIn(I.prototype),Object.defineProperties(I.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(I.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});var F=Symbol("Request internals"),M=r.default.parse,N=r.default.format,D="destroy"in b.default.Readable.prototype;function G(e){return"object"===_typeof(e)&&"object"===_typeof(e[F])}var $=function(){function s(e){_classCallCheck(this,s);var t,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};G(e)?t=M(e.url):(t=e&&e.href?M(e.href):M("".concat(e)),e={});var o=(o=r.method||e.method||"GET").toUpperCase();if((null!=r.body||G(e)&&null!==e.body)&&("GET"===o||"HEAD"===o))throw new TypeError("Request with GET/HEAD method cannot have body");var n=null!=r.body?r.body:G(e)&&null!==e.body?E(e):null;g.call(this,n,{timeout:r.timeout||e.timeout||0,size:r.size||e.size||0});var i=new A(r.headers||e.headers||{});null==n||i.has("Content-Type")||(a=k(n))&&i.append("Content-Type",a);var a,n=G(e)?e.signal:null;if(null!=(n="signal"in r?r.signal:n)&&(!(a=(a=n)&&"object"===_typeof(a)&&Object.getPrototypeOf(a))||"AbortSignal"!==a.constructor.name))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[F]={method:o,redirect:r.redirect||e.redirect||"follow",headers:i,parsedURL:t,signal:n},this.follow=void 0!==r.follow?r.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==r.compress?r.compress:void 0===e.compress||e.compress,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent}return _createClass(s,[{key:"method",get:function(){return this[F].method}},{key:"url",get:function(){return N(this[F].parsedURL)}},{key:"headers",get:function(){return this[F].headers}},{key:"redirect",get:function(){return this[F].redirect}},{key:"signal",get:function(){return this[F].signal}},{key:"clone",value:function(){return new s(this)}}]),s}();function J(e){var t=e[F].parsedURL,r=new A(e[F].headers);if(r.has("Accept")||r.set("Accept","*/*"),!t.protocol||!t.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(t.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof b.default.Readable&&!D)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");var o,n=null;null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(n="0"),null==e.body||"number"==typeof(o=S(e))&&(n=String(o)),n&&r.set("Content-Length",n),r.has("User-Agent")||r.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip,deflate");n=e.agent;return"function"==typeof n&&(n=n(t)),r.has("Connection")||n||r.set("Connection","close"),Object.assign({},t,{method:e.method,headers:(e=r,r=Object.assign({__proto__:null},e[H]),void 0!==(e=C(e[H],"Host"))&&(r[e]=r[e][0]),r),agent:n})}function V(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}g.mixIn($.prototype),Object.defineProperty($.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties($.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),((V.prototype=Object.create(Error.prototype)).constructor=V).prototype.name="AbortError";var Z=b.default.PassThrough,K=r.default.resolve;function W(n,i){if(!W.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return g.Promise=W.Promise,new W.Promise(function(u,c){function e(){var e=new V("The user aborted a request.");c(e),p.body&&p.body instanceof b.default.Readable&&p.body.destroy(e),d&&d.body&&d.body.emit("error",e)}var l,t,f,p=new $(n,i),r=J(p),o=("https:"===r.protocol?s:a).default.request,h=p.signal,d=null;function y(){t.abort(),h&&h.removeEventListener("abort",l),clearTimeout(f)}h&&h.aborted?e():(l=function(){e(),y()},t=o(r),h&&h.addEventListener("abort",l),p.timeout&&t.once("socket",function(e){f=setTimeout(function(){c(new v("network timeout at: ".concat(p.url),"request-timeout")),y()},p.timeout)}),t.on("error",function(e){c(new v("request to ".concat(p.url," failed, reason: ").concat(e.message),"system",e)),y()}),t.on("response",function(e){clearTimeout(f);var t=function(e){for(var t=new A,r=0,o=Object.keys(e);r<o.length;r++){var n=o[r];if(!x.test(n))if(Array.isArray(e[n])){var i,a=_createForOfIteratorHelper(e[n]);try{for(a.s();!(i=a.n()).done;){var s=i.value;O.test(s)||(void 0===t[H][n]?t[H][n]=[s]:t[H][n].push(s))}}catch(e){a.e(e)}finally{a.f()}}else O.test(e[n])||(t[H][n]=[e[n]])}return t}(e.headers);if(W.isRedirect(e.statusCode)){var r=t.get("Location"),o=null===r?null:K(p.url,r);switch(p.redirect){case"error":return c(new v("uri requested responds with a redirect, redirect mode is set to error: ".concat(p.url),"no-redirect")),void y();case"manual":if(null!==o)try{t.set("Location",o)}catch(e){c(e)}break;case"follow":if(null===o)break;if(p.counter>=p.follow)return c(new v("maximum redirect reached at: ".concat(p.url),"max-redirect")),void y();var n={headers:new A(p.headers),follow:p.follow,counter:p.counter+1,agent:p.agent,compress:p.compress,method:p.method,body:p.body,signal:p.signal,timeout:p.timeout,size:p.size};return 303!==e.statusCode&&p.body&&null===S(p)?(c(new v("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void y()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==p.method)||(n.method="GET",n.body=void 0,n.headers.delete("content-length")),u(W(new $(o,n))),void y())}}e.once("end",function(){h&&h.removeEventListener("abort",l)});var i=e.pipe(new Z),a={url:p.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:p.size,timeout:p.timeout,counter:p.counter},s=t.get("Content-Encoding");if(!p.compress||"HEAD"===p.method||null===s||204===e.statusCode||304===e.statusCode)return d=new I(i,a),void u(d);r={flush:m.default.Z_SYNC_FLUSH,finishFlush:m.default.Z_SYNC_FLUSH};if("gzip"==s||"x-gzip"==s)return i=i.pipe(m.default.createGunzip(r)),d=new I(i,a),void u(d);if("deflate"!=s&&"x-deflate"!=s){if("br"==s&&"function"==typeof m.default.createBrotliDecompress)return i=i.pipe(m.default.createBrotliDecompress()),d=new I(i,a),void u(d);d=new I(i,a),u(d)}else e.pipe(new Z).once("data",function(e){i=8==(15&e[0])?i.pipe(m.default.createInflate()):i.pipe(m.default.createInflateRaw()),d=new I(i,a),u(d)})}),o=t,null===(r=(r=p).body)?o.end():P(r)?r.stream().pipe(o):Buffer.isBuffer(r)?(o.write(r),o.end()):r.pipe(o))})}W.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},W.Promise=global.Promise;var Y,Q,X=(Y=Object.freeze({__proto__:null,default:W,Headers:A,Request:$,Response:I,FetchError:v}))&&Y.default||Y,ee=(function(e,t){function r(e,t){return/^\/\//.test(e)&&(e="https:"+e),o.call(this,e,t)}var o=X.default||X;r.ponyfill=!0,e.exports=t=r,t.fetch=r,t.Headers=X.Headers,t.Request=X.Request,t.Response=X.Response,t.default=r}(Q={exports:{}},Q.exports),Q.exports);ee.fetch,ee.Headers,ee.Request,ee.Response;u.HaxanErrorType=void 0,(r=u.HaxanErrorType||(u.HaxanErrorType={})).NetworkError="NetworkError",r.ParseError="ParseError",r.Timeout="Timeout",r.Abort="Abort";var te=(re.prototype.getMessage=function(){return this.message},re.prototype.getType=function(){return this.type},re.prototype.getOriginalError=function(){return this.rawError},re.prototype.getResponse=function(){return this.response},re);function re(e,t,r,o){this.rawError=null,this.response=null,this.message=t,this.type=e,r&&(this.rawError=r),o&&(this.response=o)}u.ResponseType=void 0,(r=u.ResponseType||(u.ResponseType={})).Auto="auto",r.Json="json",r.Text="text",r.Stream="stream",u.HTTPMethod=void 0,(r=u.HTTPMethod||(u.HTTPMethod={})).Get="GET",r.Post="POST",r.Put="PUT",r.Patch="PATCH",r.Delete="DELETE",r.Head="HEAD",r.Options="OPTIONS";var oe=Object.freeze({__proto__:null,get ResponseType(){return u.ResponseType},get HTTPMethod(){return u.HTTPMethod},get HaxanErrorType(){return u.HaxanErrorType},HaxanError:te});var ne=function(){return(ne=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},ie=function(e,a,s,u){return new(s=s||Promise)(function(r,t){function o(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(o,n)}i((u=u.apply(e,a||[])).next())})},ae=function(r,o){var n,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(a=2&t[0]?i.return:t[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,t[1])).done)return a;switch(i=0,(t=a?[2&t[0],a.value]:t)[0]){case 0:case 1:a=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(a=0<(a=s.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){s.label=t[1];break}if(6===t[0]&&s.label<a[1]){s.label=a[1],a=t;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(t);break}a[2]&&s.ops.pop(),s.trys.pop();continue}t=o.call(r,s)}catch(e){t=[6,e],i=0}finally{n=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};var se=(ue.prototype.setProp=function(e,t){return this._opts[e]=t,this},ue.prototype.url=function(e){return this.setProp("url",e)},ue.prototype.type=function(e){return this.setProp("type",e)},ue.prototype.method=function(e){return this.setProp("method",e)},ue.prototype.get=function(){return this.method("GET")},ue.prototype.head=function(){return this.method("HEAD")},ue.prototype.options=function(){return this.method("OPTIONS")},ue.prototype.post=function(e){return this.body(e).method("POST")},ue.prototype.put=function(e){return this.body(e).method("PUT")},ue.prototype.patch=function(e){return this.body(e).method("PATCH")},ue.prototype.delete=function(){return this.method("DELETE")},ue.prototype.body=function(e){return this.setProp("body",e)},ue.prototype.header=function(e,t){return this._opts.headers[e]=t,this},ue.prototype.param=function(e,t){return this._opts.query[e]=t,this},ue.prototype.timeout=function(e){return this.setProp("timeout",e)},ue.prototype.abort=function(e){return this.setProp("abortSignal",e)},ue.prototype.normalizedBody=function(){var e=this._opts.body;return null===e?null:"string"==typeof e?e:JSON.stringify(e)},ue.prototype.parseBody=function(r){return ie(this,void 0,void 0,function(){var t;return ae(this,function(e){switch(e.label){case 0:return(t=r.headers.get("content-type"))&&t.startsWith("application/json")?[4,r.json()]:[3,2];case 1:return[2,e.sent()];case 2:return[4,r.text()];case 3:return[2,e.sent()]}})})},ue.prototype.getOptions=function(){return this._opts},ue.prototype.send=function(){return this.execute()},ue.prototype.execute=function(){return this.request()},ue.prototype.parseResponse=function(s){return ie(this,void 0,void 0,function(){var o,n,i,a;return ae(this,function(e){switch(e.label){case 0:return(e.trys.push([0,8,,9]),t=s.headers,r={},t.forEach(function(e,t){r[t]=e}),o=r,this._opts.type!==u.ResponseType.Auto)?[3,2]:(n={},[4,this.parseBody(s)]);case 1:return[2,(n.data=e.sent(),n.ok=s.ok,n.status=s.status,n.headers=o,n)];case 2:return this._opts.type!==u.ResponseType.Json?[3,4]:(i={},[4,s.json()]);case 3:return[2,(i.data=e.sent(),i.ok=s.ok,i.status=s.status,i.headers=o,i)];case 4:return this._opts.type!==u.ResponseType.Text?[3,6]:(a={},[4,s.text()]);case 5:return[2,(a.data=e.sent(),a.ok=s.ok,a.status=s.status,a.headers=o,a)];case 6:if(this._opts.type===u.ResponseType.Stream&&("undefined"==typeof window||"[object Window]"!=={}.toString.call(window)))return[2,{data:s.body,ok:s.ok,status:s.status,headers:o}];e.label=7;case 7:throw new te(u.HaxanErrorType.ParseError,"No valid response body parsing method found",null,{data:s.body,ok:s.ok,status:s.status,headers:o});case 8:if((o=e.sent()).type===u.HaxanErrorType.ParseError)throw o;throw new Error("Error during parsing response body: "+o.message);case 9:return[2]}var t,r})})},ue.prototype.buildUrl=function(){return Object.keys(this._opts.query).length?this._opts.url+"?"+(t=this._opts.query,Object.keys(t).map(function(e){return e+"="+String(t[e])}).join("&")):this._opts.url;var t},ue.prototype.doRequest=function(){return ie(this,void 0,void 0,function(){var r;return ae(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,ee(this.buildUrl(),{method:this._opts.method,headers:ne(ne({"Content-Type":"application/json"},this._opts.headers),{"User-Agent":"Haxan 0.4.1"}),body:(t=this._opts.method,[u.HTTPMethod.Put,u.HTTPMethod.Post,u.HTTPMethod.Patch].includes(t.toUpperCase())?this.normalizedBody():void 0),signal:this._opts.abortSignal})];case 1:return r=e.sent(),[4,this.parseResponse(r)];case 2:return[2,e.sent()];case 3:if((r=e.sent()).getType)throw r;if("AbortError"===r.name)throw new te(u.HaxanErrorType.Abort,"Request aborted",r);throw new te(u.HaxanErrorType.NetworkError,"Network error",r);case 4:return[2]}var t})})},ue.prototype.request=function(){return ie(this,void 0,void 0,function(){return ae(this,function(e){switch(e.label){case 0:return[4,Promise.race([this.doRequest(),(r=this._opts.timeout,new Promise(function(e,t){return setTimeout(function(){return t(new te(u.HaxanErrorType.Timeout,"Request timed out (Reached "+r+"ms)",null))},r)}))])];case 1:return[2,e.sent()]}var r})})},ue);function ue(e,t){this._opts={url:"",headers:{},query:{},method:u.HTTPMethod.Get,body:void 0,type:u.ResponseType.Auto,abortSignal:void 0,timeout:3e4},t&&Object.assign(this._opts,t),this.url(e)}function ce(e,t){return new se(e,t)}r=function(){var e,t=ce;for(e in oe)t[e]=oe[e];return t.HaxanFactory=se,t}();u.HaxanError=te,u.HaxanFactory=se,u.default=r,Object.defineProperty(u,"__esModule",{value:!0})});
